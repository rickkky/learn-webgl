<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebGl Fundamental</title>

    <style>
      html,
      body,
      #app {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        background-color: #f0f0f0;
      }
      #canvas {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        width: 60vmin;
        height: 60vmin;
        background-color: #ffffff;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <canvas id="canvas"></canvas>
    </div>

    <script type="module">
      function fetchShader(url) {
        return fetch(url).then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`)
          } else {
            return response.text()
          }
        })
      }

      function createShader(gl, type, source) {
        const shader = gl.createShader(type)
        gl.shaderSource(shader, source)
        gl.compileShader(shader)
        const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS)
        if (success) {
          return shader
        }
        gl.deleteShader(shader)
        console.log(gl.getShaderInfoLog(shader))
      }

      function createProgram(gl, vertexShader, fragmentShader) {
        const program = gl.createProgram()
        gl.attachShader(program, vertexShader)
        gl.attachShader(program, fragmentShader)
        gl.linkProgram(program)
        const success = gl.getProgramParameter(program, gl.LINK_STATUS)
        if (success) {
          return program
        }
        gl.deleteProgram(program)
        console.log(gl.getProgramInfoLog(program))
      }

      const canvas = document.getElementById('canvas')
      const gl = canvas.getContext('webgl2')

      // const vertexShaderSource = await fetchShader('./vertex.glsl')
      const vertexShaderSource = `#version 300 es
      
      // default { x: 0, y: 0, z: 0, w: 1 }
      in vec4 a_position;

      void main() {
          gl_Position = a_position;
      }
      `
      const fragmentShaderSource = `#version 300 es

      precision highp float;

      out vec4 outColor;

      void main() {
          outColor = vec4(1, 0, 0.5, 1);
      }
      `
      const vertexShader = createShader(
        gl,
        gl.VERTEX_SHADER,
        vertexShaderSource
      )
      const fragmentShader = createShader(
        gl,
        gl.FRAGMENT_SHADER,
        fragmentShaderSource
      )
      const program = createProgram(gl, vertexShader, fragmentShader)

      const positionBuffer = gl.createBuffer()
      gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)
      const positions = [0, 0, 0, 0.5, 0.7, 0]
      gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array(positions),
        gl.STATIC_DRAW
      )

      const vao = gl.createVertexArray()
      gl.bindVertexArray(vao)
      const positionAttributeLocation = gl.getAttribLocation(
        program,
        'a_position'
      )
      gl.enableVertexAttribArray(positionAttributeLocation)
      // implicitly bind the current gl.ARRAY_BUFFER to the attribute
      gl.vertexAttribPointer(
        positionAttributeLocation,
        // size
        2,
        // type
        gl.FLOAT,
        // normalize
        false,
        // stride
        0,
        // offset
        0
      )
    </script>
  </body>
</html>
